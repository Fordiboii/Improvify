image: krissrex/docker-java8-maven-testfxmonocle:1.0

cache:
  paths:
    - .m2/repository
  # keep cache across branch
  key: "$CI_BUILD_REF_NAME"

variables:
  HEADLESS_TESTFX: "-Djava.awt.headless=true -Dtestfx.robot=glass -Dtestfx.headless=true -Dglass.platform=Monocle -Dmonocle.platform=Headless -Dprism.order=sw -Dprism.text=t2k -Dtestfx.setup.timeout=2500 -Dprism.verbose=true"
  MAVEN_OPTS: "-Dmaven.repo.local=.m2/repository -Djava.awt.headless=true"
  MAVEN_CLI_OPTS: "--batch-mode --errors --fail-at-end --show-version"

build-job:
  stage: build
  script:
    - "mvn clean compile -f tdt4140-gr1817/pom.xml $MAVEN_CLI_OPTS"

unittest-job:
  stage: test
  dependencies:
    - build-job
  script:
    - "mvn package -f tdt4140-gr1817/pom.xml $MAVEN_CLI_OPTS -DargLine=\"$HEADLESS_TESTFX\""
    #- "cat tdt4140-gr1817/app.core/target/site/jacoco/index.html 2>/dev/null"

integrationtest-job:
  stage: test
  dependencies:
    - build-job
  script:
    # surefire blocks propagation of properties that are not set inside argLine
    - "mvn verify -f tdt4140-gr1817/pom.xml $MAVEN_CLI_OPTS -DargLine=\"$HEADLESS_TESTFX\""
